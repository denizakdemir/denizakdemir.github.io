<!-- GitHub Repositories Section -->
<div class="repositories-section my-5">
  <h2 class="text-center mb-4">My GitHub Repositories</h2>
  <div id="github-repos" class="repositories-container">
    <p class="text-center mb-3">Loading repositories...</p>
  </div>
</div>

<script>
// GitHub Repositories Loader
document.addEventListener('DOMContentLoaded', function() {
  const username = 'denizakdemir';
  const reposContainer = document.getElementById('github-repos');
  
  // Function to format the repository HTML
  function formatRepo(repo) {
    return `
      <div class="card mb-3 p-3">
        <h3 class="h5"><a href="${repo.html_url}" target="_blank" rel="noopener">${repo.name}</a></h3>
        <p class="mb-2">${repo.description || 'No description available'}</p>
        <div class="small text-muted">
          ${repo.language ? `<span class="me-3">${repo.language}</span>` : ''}
          <span class="me-3">‚≠ê ${repo.stargazers_count}</span>
          <span>üî± ${repo.forks_count}</span>
        </div>
      </div>
    `;
  }

  // Register the callback function first to ensure it's available
  window.displayGitHubRepos = function(response) {
    console.log('GitHub API callback triggered');
    if (response && response.data) {
      console.log('GitHub API responded with', response.meta ? response.meta.status : 'unknown status');
      
      if (response.meta && response.meta.status >= 400) {
        reposContainer.innerHTML = `<p class="text-center text-danger">Error loading repositories. Status: ${response.meta.status}</p>`;
        console.error('GitHub API error:', response.meta);
        return;
      }
      
      displayRepos(response.data);
    } else {
      reposContainer.innerHTML = '<p class="text-center text-danger">Error loading repositories. Please try again later.</p>';
      console.error('GitHub API error:', response);
    }
  };
  
  // Function to display repositories
  function displayRepos(repos) {
    if (!repos || repos.length === 0) {
      reposContainer.innerHTML = '<p class="text-center">No repositories found.</p>';
      return;
    }
    
    // Filter out forks if you want to show only original repos
    const ownRepos = repos.filter(repo => !repo.fork);
    
    // Sort by stars (most stars first)
    ownRepos.sort((a, b) => b.stargazers_count - a.stargazers_count);
    
    // Take top 6 repos
    const topRepos = ownRepos.slice(0, 6);
    
    const reposHTML = topRepos.map(formatRepo).join('');
    reposContainer.innerHTML = reposHTML + 
      `<div class="text-center mt-3">
        <a href="https://github.com/${username}?tab=repositories" class="btn btn-outline-primary" 
           target="_blank" rel="noopener">View All Repositories</a>
      </div>`;
  }
  
  // Alternative fetch method using XHR as a fallback
  function loadReposWithXHR() {
    console.log('Attempting to load repos with XHR');
    const xhr = new XMLHttpRequest();
    xhr.open('GET', `https://api.github.com/users/${username}/repos?sort=updated&per_page=100`);
    xhr.onload = function() {
      if (xhr.status === 200) {
        try {
          const repos = JSON.parse(xhr.responseText);
          displayRepos(repos);
        } catch (e) {
          console.error('Error parsing GitHub API response:', e);
          reposContainer.innerHTML = '<p class="text-center text-danger">Error processing repository data.</p>';
        }
      } else {
        console.error('GitHub API XHR error:', xhr.status, xhr.statusText);
        reposContainer.innerHTML = `<p class="text-center text-danger">Error loading repositories. Status: ${xhr.status}</p>`;
        // If rate limited, try JSONP as last resort
        if (xhr.status === 403) {
          loadReposWithJSONP();
        }
      }
    };
    xhr.onerror = function() {
      console.error('GitHub API XHR request failed');
      loadReposWithJSONP(); // Try JSONP as fallback
    };
    xhr.send();
  }
  
  // JSONP approach for GitHub Pages compatibility
  function loadReposWithJSONP() {
    console.log('Loading repos with JSONP');
    const script = document.createElement('script');
    script.src = `https://api.github.com/users/${username}/repos?callback=displayGitHubRepos&sort=updated&per_page=100`;
    document.body.appendChild(script);
  }
  
  // Try XHR first, with JSONP as fallback
  try {
    loadReposWithXHR();
  } catch (e) {
    console.error('XHR attempt failed:', e);
    loadReposWithJSONP();
  }
});
</script>